<!DOCTYPE html>
<html>

<head>

    <script src="https://cdn.jsdelivr.net/npm/arquero@latest"></script>

</head>

<body>

    <script>

        var dataTable = [];
        var geoTable = [];
        var joinedData = [];

        // load the data file
        function loadData() {
            aq.loadJSON('2380.json')
            .then(data => {
            
                // console.log("---- JSON long data ----")
                // data.print();
                
                // making wide
                
                dataTable =
                    data
                    .groupby("Geotype", "GeoID", "Year")
                    .pivot("MeasureName", "Value")
                
                console.log("---- JSON wide data ----")
                dataTable.print();

                return dataTable;
 
            });
            loadGeo() // run the next function
        }

        // load the Geo file
        function loadGeo() {
            aq.loadCSV("../Data Explorer Files/GeoLookup.csv")
            .then(data => {
                geoTable = data;
                console.log("---- Geo Names ----")
                geoTable.print();
                joinData(); // run the next function
            });            
        }

        // join the data
        function joinData() {
            joinedData = dataTable.join_left(geoTable)
            console.log("---- JSON + GeoLookup ----")
            joinedData.print();
        }

        // run the first function
        loadData();

        
    </script>

</body>