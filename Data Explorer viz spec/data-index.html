<!DOCTYPE html>

<head>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/core-js/2.6.11/core.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/7.8.7/polyfill.js"></script>
  <script src="https://vega.github.io/vega/assets/promise.min.js"></script>
  <script src="https://vega.github.io/vega/assets/symbol.min.js"></script>
  <script src="https://vega.github.io/vega/assets/fetch.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega@5/build-es5/vega.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@4/build-es5/vega-lite.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6/build-es5/vega-embed.js"></script>

  <!--D3-->
  <script src="https://d3js.org/d3.v5.min.js"></script>

  <!--CSS-->
  <link rel="stylesheet" href="basicstyle.css">

  <!--Arquero-->
  <script src="https://cdn.jsdelivr.net/npm/arquero@latest"></script>

  <!--DataTables CSS-->
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.1.0/css/buttons.dataTables.min.css">

  <!--jQuery and DataTables JS-->
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.1.0/js/dataTables.buttons.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.1.0/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.1.0/js/buttons.print.min.js"></script>
  <script src="https://cdn.datatables.net/rowgroup/1.1.4/js/dataTables.rowGroup.min.js"></script>

</head>

<body>

  <style>
    table {
      border-collapse: collapse;
      border-spacing: 0
    }
    th, td {
      padding: 10px 20px;
      border: 1px solid #e5e5e5;
    }
    th {
      color: white;
      font-style: bold;
      background-color: #666666;
      text-align: left;
    }
  </style>

  <div id="container">
    <h1>Data Index</h1>
    <p>Scaffolding out a 'data index' page. Here's what that will entail:
      <ul>
        <li>Ingesting Indicators.json</li>
        <li>Looping through and creating a table that includes Indicator Name, Measurement types, Geographies, and times</li>
        <li>TO DO: Styling that table as a DataTables table, with search and sort</li>
      </ul>

    </p>

    <hr>

    <p>Below, we ingest basically everything from that list. But it might be better to Geographies as 'finest geography' and Times as 'most recent time'. Also, is "Measurements" useful?</p>

    <table id="indicators">
      <thead>
        <tr>
          <th>Indicator</th>
          <th>Measurements</th>
          <th>Geographies</th>
          <th>Most recent year</th>
        </tr>
      </thead>

      <tbody id="tablebody">
        <tr>
          <td>Indicator one</td>
          <td>Number, rate</td>
          <td>Community District</td>
          <td>2019</td>
        </tr>
      </tbody>

    </table>

<script>
  var indicators;
  var indicatorIndex = []


  // First, load Indicators.json
  d3.json('https://raw.githubusercontent.com/nychealth/EHDP-data/main/indicators/indicators.json').then(function (data) {
    indicators = data;

    // console.table(indicators)

    // then, loop through indicators
    for (let i = 0; i < indicators.length; i++) {
        let row_i = document.createElement('tr'); // create row
        let cell_1 = document.createElement('td') // create cell
        cell_1.innerHTML = indicators[i].IndicatorName // fill cell with indicator name.
        row_i.appendChild(cell_1); // add this cell to this row

        // create other cells. 
        let cell_2 = document.createElement('td')
        let cell_3 = document.createElement('td')
        let cell_4 = document.createElement('td')

        // loop through each indicator's measure:
          for (let n = 0; n < indicators[i].Measures.length; n++) {
            // push Measurement Types to the second cell
            var measurements = [];
            measurements.push(indicators[i].Measures[n].MeasurementType)

            // loop through Available Geographies
            var geographies = [];
            for (let y = 0; y < indicators[i].Measures[n].AvailableGeographyTypes.length; y++) {
              geographies.push(indicators[i].Measures[n].AvailableGeographyTypes[y].GeoType)
            }

            //loop through times
            var times = [];
            for (let z = 0; z < indicators[i].Measures[n].AvailableTimes.length; z++) {
              times.push(indicators[i].Measures[n].AvailableTimes[z].TimeDescription)
            }

          }

        // And, dump measurements, geographies, and times into cells:

        cell_2.innerHTML = measurements;
        row_i.appendChild(cell_2);

        cell_3.innerHTML = geographies;
        row_i.appendChild(cell_3)

        cell_4.innerHTML = times;
        row_i.appendChild(cell_4);

        // Finally, place the row into the table body.
        document.getElementById('tablebody').appendChild(row_i) 
    } 

  }); 




</script>

</body>