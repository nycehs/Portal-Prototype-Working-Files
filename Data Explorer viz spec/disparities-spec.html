<!DOCTYPE html>
<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/core-js/2.6.11/core.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/7.8.7/polyfill.js"></script>
    <script src="https://vega.github.io/vega/assets/promise.min.js"></script>
    <script src="https://vega.github.io/vega/assets/symbol.min.js"></script>
    <script src="https://vega.github.io/vega/assets/fetch.min.js"></script>

    <!-- these three added for utd versions--> 
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

    <!--D3-->
    <script src="https://d3js.org/d3.v5.min.js"></script>

            <!--CSS-->
    <style>
      body {
        max-width: 700px;
        margin: auto;
      }
    
      #container {
        max-width: 700px;
      }
    
      .chartdest {
        width: 100%;
        min-height: 450px;
        margin-bottom: 50px;
      }
    
      code {
        color: white;
        background-color: rgb(73, 73, 73);
        padding-left: 3px;
        padding-right: 3px;
      }
    </style>
</head>
<body>



  <div id="container">

    <h1>VL Disparities Spec</h1>

    <p>First, on <a href="https://a816-dohbesp.nyc.gov/IndicatorPublic/beta/data-explorer/asthma/?id=2380#display=links"></a>Asthma ED Visits (adults)</a>, I went to the Links view, linked it with Poverty, went into the console, and copied <code>joinedDataLinksObjects</code>. In the Data Explorer code, this is passed into <code>renderLinksChart()</code> in <code>links.js</code> as the data object.</p>
    <p>Since in the existing code, that object gets passed into the Links spec, I used that same object as <code>data</code> in the script below to pass into the spec.</p>

    <hr>
    <p>Second, we took the compiled spec from a Links view, and modified it. We added the following:
      <ul>
        <li>Several Transforms, which let us calculate PovCat and PovRank from the poverty value (Value_2 as passed in)</li>
        <li>A jitter field using random(), which we then use in xOffset to jitter the categories</li>
        <li>Some layout specificity to encoding.x.axis to use text (PovCat) as the labels</li>
      </ul>
    </p>

    <p>Most likely, when this is implemented in situ, there may be some other small layout changes we'll have to make in order to ensure that the correct info from the page/interaction is passed into the spec and other page displays. </p>

    <div id="vis" class="chartdest"></div>
    
  </div>



<script type="text/javascript">

var data = [
  {
      "GeoID": 101,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Kingsbridge - Riverdale",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 60.2,
      "DisplayValue_1": "60.2",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 15.69,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "15.7",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Kingsbridge - Riverdale",
      "BoroID": 1,
      "Borough": "Bronx",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 102,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Northeast Bronx",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 125.7,
      "DisplayValue_1": "125.7",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 15.57,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "15.6",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Northeast Bronx",
      "BoroID": 1,
      "Borough": "Bronx",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 103,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Fordham - Bronx Pk",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 155.8,
      "DisplayValue_1": "155.8",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 31.43,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "31.4",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Fordham - Bronx Pk",
      "BoroID": 1,
      "Borough": "Bronx",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 104,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Pelham - Throgs Neck",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 112.1,
      "DisplayValue_1": "112.1",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 22.12,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "22.1",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Pelham - Throgs Neck",
      "BoroID": 1,
      "Borough": "Bronx",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 105,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Crotona -Tremont",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 224.2,
      "DisplayValue_1": "224.2",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 38.61,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "38.6",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Crotona -Tremont",
      "BoroID": 1,
      "Borough": "Bronx",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 106,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "High Bridge - Morrisania",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 235.8,
      "DisplayValue_1": "235.8",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 37.48,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "37.5",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "High Bridge - Morrisania",
      "BoroID": 1,
      "Borough": "Bronx",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 107,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Hunts Point - Mott Haven",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 256,
      "DisplayValue_1": "256.0",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 39.73,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "39.7",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Hunts Point - Mott Haven",
      "BoroID": 1,
      "Borough": "Bronx",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 201,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Greenpoint",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 51.5,
      "DisplayValue_1": "51.5",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 22.11,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "22.1",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Greenpoint",
      "BoroID": 2,
      "Borough": "Brooklyn",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 202,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Downtown - Heights - Slope",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 71.3,
      "DisplayValue_1": "71.3",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 14.83,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "14.8",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Downtown - Heights - Slope",
      "BoroID": 2,
      "Borough": "Brooklyn",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 203,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Bedford Stuyvesant - Crown Heights",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 175.2,
      "DisplayValue_1": "175.2",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 24.7,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "24.7",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Bedford Stuyvesant - Crown Heights",
      "BoroID": 2,
      "Borough": "Brooklyn",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 204,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "East New York",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 183.1,
      "DisplayValue_1": "183.1",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 27.27,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "27.3",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "East New York",
      "BoroID": 2,
      "Borough": "Brooklyn",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 205,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Sunset Park",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 46.8,
      "DisplayValue_1": "46.8",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 27.75,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "27.8",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Sunset Park",
      "BoroID": 2,
      "Borough": "Brooklyn",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 206,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Borough Park",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 28.3,
      "DisplayValue_1": "28.3",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 25.61,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "25.6",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Borough Park",
      "BoroID": 2,
      "Borough": "Brooklyn",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 207,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "East Flatbush - Flatbush",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 117.5,
      "DisplayValue_1": "117.5",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 16.26,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "16.3",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "East Flatbush - Flatbush",
      "BoroID": 2,
      "Borough": "Brooklyn",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 208,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Canarsie - Flatlands",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 84.2,
      "DisplayValue_1": "84.2",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 11.58,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "11.6",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Canarsie - Flatlands",
      "BoroID": 2,
      "Borough": "Brooklyn",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 209,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Bensonhurst - Bay Ridge",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 20.9,
      "DisplayValue_1": "20.9",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 15.3,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "15.3",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Bensonhurst - Bay Ridge",
      "BoroID": 2,
      "Borough": "Brooklyn",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 210,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Coney Island - Sheepshead Bay",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 47.3,
      "DisplayValue_1": "47.3",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 19.61,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "19.6",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Coney Island - Sheepshead Bay",
      "BoroID": 2,
      "Borough": "Brooklyn",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 211,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Williamsburg - Bushwick",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 158.7,
      "DisplayValue_1": "158.7",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 30.02,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "30.0",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Williamsburg - Bushwick",
      "BoroID": 2,
      "Borough": "Brooklyn",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 301,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Washington Heights",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 75.3,
      "DisplayValue_1": "75.3",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 21.49,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "21.5",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Washington Heights",
      "BoroID": 3,
      "Borough": "Manhattan",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 302,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Central Harlem - Morningside Heights",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 218.6,
      "DisplayValue_1": "218.6",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 27.14,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "27.1",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Central Harlem - Morningside Heights",
      "BoroID": 3,
      "Borough": "Manhattan",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 303,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "East Harlem",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 262.4,
      "DisplayValue_1": "262.4",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 34.56,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "34.6",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "East Harlem",
      "BoroID": 3,
      "Borough": "Manhattan",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 304,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Upper West Side",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 56,
      "DisplayValue_1": "56.0",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 10.62,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "10.6",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Upper West Side",
      "BoroID": 3,
      "Borough": "Manhattan",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 305,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Upper East Side",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 18,
      "DisplayValue_1": "18.0",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 5.84,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "5.8",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Upper East Side",
      "BoroID": 3,
      "Borough": "Manhattan",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 306,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Chelsea - Clinton",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 52.2,
      "DisplayValue_1": "52.2",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 12.81,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "12.8",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Chelsea - Clinton",
      "BoroID": 3,
      "Borough": "Manhattan",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 307,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Gramercy Park - Murray Hill",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 39.3,
      "DisplayValue_1": "39.3",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 8.56,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "8.6",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Gramercy Park - Murray Hill",
      "BoroID": 3,
      "Borough": "Manhattan",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 308,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Greenwich Village - SoHo",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 14.3,
      "DisplayValue_1": "14.3",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 9.58,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "9.6",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Greenwich Village - SoHo",
      "BoroID": 3,
      "Borough": "Manhattan",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 309,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Union Square - Lower East Side",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 78.8,
      "DisplayValue_1": "78.8",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 21.39,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "21.4",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Union Square - Lower East Side",
      "BoroID": 3,
      "Borough": "Manhattan",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 310,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Lower Manhattan",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 56.7,
      "DisplayValue_1": "56.7",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 10.07,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "10.1",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Lower Manhattan",
      "BoroID": 3,
      "Borough": "Manhattan",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 401,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Long Island City - Astoria",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 51.3,
      "DisplayValue_1": "51.3",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 13.61,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "13.6",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Long Island City - Astoria",
      "BoroID": 4,
      "Borough": "Queens",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 402,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "West Queens",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 37.8,
      "DisplayValue_1": "37.8",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 14.78,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "14.8",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "West Queens",
      "BoroID": 4,
      "Borough": "Queens",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 403,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Flushing - Clearview",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 20.5,
      "DisplayValue_1": "20.5",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 15.52,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "15.5",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Flushing - Clearview",
      "BoroID": 4,
      "Borough": "Queens",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 404,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Bayside - Little Neck",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 14,
      "DisplayValue_1": "14.0",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 7.72,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "7.7",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Bayside - Little Neck",
      "BoroID": 4,
      "Borough": "Queens",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 405,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Ridgewood - Forest Hills",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 32.9,
      "DisplayValue_1": "32.9",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 10.6,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "10.6",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Ridgewood - Forest Hills",
      "BoroID": 4,
      "Borough": "Queens",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 406,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Fresh Meadows",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 33.8,
      "DisplayValue_1": "33.8",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 12.85,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "12.8",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Fresh Meadows",
      "BoroID": 4,
      "Borough": "Queens",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 407,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Southwest Queens",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 45.4,
      "DisplayValue_1": "45.4",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 12.92,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "12.9",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Southwest Queens",
      "BoroID": 4,
      "Borough": "Queens",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 408,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Jamaica",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 62.3,
      "DisplayValue_1": "62.3",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 12.94,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "12.9",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Jamaica",
      "BoroID": 4,
      "Borough": "Queens",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 409,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Southeast Queens",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 43.9,
      "DisplayValue_1": "43.9",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 6.43,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "6.4",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Southeast Queens",
      "BoroID": 4,
      "Borough": "Queens",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 410,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Rockaways",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 110.4,
      "DisplayValue_1": "110.4",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 18.86,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "18.9",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Rockaways",
      "BoroID": 4,
      "Borough": "Queens",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 501,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Port Richmond",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 135.3,
      "DisplayValue_1": "135.3",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 20.76,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "20.8",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Port Richmond",
      "BoroID": 5,
      "Borough": "Staten Island",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 502,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Stapleton - St. George",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 95.5,
      "DisplayValue_1": "95.5",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 18.94,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "18.9",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Stapleton - St. George",
      "BoroID": 5,
      "Borough": "Staten Island",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 503,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "Willowbrook",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 42.1,
      "DisplayValue_1": "42.1",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 9.55,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "9.6",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "Willowbrook",
      "BoroID": 5,
      "Borough": "Staten Island",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  },
  {
      "GeoID": 504,
      "GeoType": "UHF42",
      "GeoTypeDesc_1": "UHF 42",
      "GeoRank_1": 4,
      "Geography_1": "South Beach - Tottenville",
      "MeasureID_1": 1199,
      "Time_1": "2018",
      "Value_1": 26.6,
      "DisplayValue_1": "26.6",
      "CI_1": "",
      "Note_1": "",
      "start_period_1": 1514764800000,
      "end_period_1": 1546214400000,
      "ban_summary_flag_1": 0,
      "MeasureID_2": 221,
      "Time_2": "2014-18",
      "ban_summary_flag_2": 0,
      "Value_2": 7.84,
      "CI_2": "",
      "Note_2": "",
      "DisplayValue_2": "7.8",
      "GeoTypeDesc_2": "UHF 42",
      "Geography_2": "South Beach - Tottenville",
      "BoroID": 5,
      "Borough": "Staten Island",
      "GeoRank_2": 4,
      "start_period_2": 1388534400000,
      "end_period_2": 1546214400000
  }
]

var spec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Asthma 5-17 ED visit rate and poverty scatterplot",
  "title": {
    "text": [
      "Asthma emegency department visits (adults)",
      "Age-adjusted rate per 10,000 (2018)"
    ],
    "align": "left",
    "anchor": "start",
    "fontSize": 12,
    "fontWeight": "normal",
    "font": "sans-serif",
    "baseline": "top",
    "dy": -10,
    "limit": 1000
  },
  "width": "container",
  "height": 500,
  "config": {
    "background": "#FFFFFF",
    "axisX": {
      "labelFontSize": 11,
      "titleFontSize": 12,
      "titleFont": "sans-serif",
      "titlePadding": 10,
      "titleFontWeight": "normal"
    },
    "axisY": {
      "labelFontSize": 11,
      "titleFontSize": 0,
      "labelAngle": 0,
      "titlePadding": 10,
      "titleFont": "sans-serif"
    },
    "legend": {
      "columns": 6,
      "labelFontSize": 14,
      "symbolSize": 140,
      "orient": "bottom",
      "title": null
    },
    "view": {"stroke": "transparent"},
    "range": {
      "category": ["#1696d2", "#fdbf11", "#ec008b", "#a8a8a8", "#55b748"]
    },
    "text": {
      "color": "#1696d2",
      "fontSize": 11,
      "align": "center",
      "fontWeight": 400,
      "size": 11
    }
  },
  "data": {
    "values": data
  },
  "transform": [
    {
      "calculate": "(datum.Value_2 > 30 ? 'Very high' : (datum.Value_2 > 20 ? 'High' : ( datum.Value_2 > 10 ? 'Moderate' : 'Low')))",
      "as": "PovCat"
    }, // gives us labels
        {
      "calculate": "(datum.Value_2 > 30 ? 4 : (datum.Value_2 > 20 ? 3 : ( datum.Value_2 > 10 ? 2 : 1)))",
      "as": "PovRank"
    }, // gives us ordinal categories
    {"calculate": "datum.PovRank + (random()*2 - 1)", "as": "random"} // jitter
  ],
  "layer": [
    {
      "mark": {
        "type": "circle",
        "filled": true,
        "size": 200,
        "stroke": "#7C7C7C",
        "strokeWidth": 2
      },
      "params": [
        {
          "name": "borough",
          "select": {"type": "point", "fields": ["Borough"], "on": "click"},
          "bind": "legend"
        },
        {
          "name": "hover",
          "value": "#7C7C7C",
          "select": {"type": "point", "on": "mouseover"}
        }
      ],
      "encoding": {
        "y": {"field": "Value_1", "type": "quantitative"},
        "x": {
          "title": ["Neighborhood Poverty"],
          "field": "PovRank", // Changed
          "type": "ordinal",
          "axis": { // added
            "labelExpr": "(datum.label == 4 ? 'Very high' : (datum. label == 3  ? 'High' : ( datum. label == 2  ? 'Moderate' : 'Low')))",
            "labelAlign": "center",
            "labelAngle": 0
          }
          },
        "xOffset": {"field": "random", "type": "quantitative"}, // Jitter
        "tooltip": [
          {"title": "Borough", "field": "Borough", "type": "nominal"},
          {"title": "Neighborhood", "field": "Geography_1", "type": "nominal"},
          {"title": "Time", "field": "Time_2", "type": "nominal"},
          {
            "title": "Asthma ED visits (adults), Age-adjusted rate",
            "field": "Value_1",
            "type": "quantitative",
            "format": ",.1~f"
          },
          {
            "title": "Poverty, Percent",
            "field": "Value_2",
            "type": "quantitative",
            "format": ",.1~f"
          },          
          {
            "title": "Neighborhood Poverty",
            "field": "PovCat",
            "type": "nominal"
          }
        ],
        "color": {"title": "Borough", "field": "Borough", "type": "nominal"},
        "opacity": {
          "condition": {"param": "borough", "empty": true, "value": 1},
          "value": 0.2
        },
        "stroke": {
          "condition": {"param": "hover", "empty": false, "value": "#7C7C7C"},
          "value": null
        }
      }
    }
  ]
}


vegaEmbed("#vis", spec);





</script>
</body>
</html>